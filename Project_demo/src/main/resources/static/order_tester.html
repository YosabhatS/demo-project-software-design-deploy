<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Restaurant Ordering Service Tester (Port 8082)</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { background: #f4f4f4; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        h2 { border-bottom: 2px solid #ccc; padding-bottom: 5px; }
        input[type="number"], input[type="text"], button { padding: 10px; margin: 5px 0; width: 90%; box-sizing: border-box; }
        button { cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; width: auto; margin-right: 10px; }
        button:hover { background: #0056b3; }
        #log, #result { background: #fff; border: 1px solid #ddd; padding: 10px; margin-top: 10px; white-space: pre-wrap; word-wrap: break-word; }
        .item-input { display: flex; gap: 10px; align-items: center; margin-bottom: 5px; }
        .item-input input { width: 40%; }
        .item-list { border: 1px dashed #aaa; padding: 10px; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>üöÄ Microservice Order Tester (Port 8082)</h1>
    <p>‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ **Data Service (8085)** ‡πÅ‡∏•‡∏∞ **Ordering Service (8082)** ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà</p>

    <div class="container">
        <h2>1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà (POST /api/orders)</h2>
        <label for="tableId">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞ (Table ID):</label>
        <input type="number" id="tableId" value="101"><br>

        <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á:</h3>
        <div id="itemsContainer" class="item-list">
            <div class="item-input">
                <input type="number" class="menu-id" placeholder="Menu ID (‡πÄ‡∏ä‡πà‡∏ô 1)" value="1">
                <input type="number" class="quantity" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (Quantity)" value="2">
                <button onclick="removeItem(this)">‡∏•‡∏ö</button>
            </div>
            <div class="item-input">
                <input type="number" class="menu-id" placeholder="Menu ID (‡πÄ‡∏ä‡πà‡∏ô 2)" value="2">
                <input type="number" class="quantity" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (Quantity)" value="1">
                <button onclick="removeItem(this)">‡∏•‡∏ö</button>
            </div>
        </div>
        <button onclick="addItemInput()" style="background: #28a745;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
        <hr>
        <button onclick="createOrder()">‡∏™‡∏£‡πâ‡∏≤‡∏á Order</button>
        <p>Order ID ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏î‡πâ: <strong id="createdOrderId">--</strong></p>
    </div>

    <div class="container">
        <h2>2. ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (GET /api/orders/{id})</h2>
        <label for="fetchOrderId">Order ID ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</label>
        <input type="number" id="fetchOrderId" placeholder="‡πÉ‡∏™‡πà Order ID (‡πÄ‡∏ä‡πà‡∏ô 1)"><br>
        <button onclick="fetchOrderDetails()">‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î Order</button>
        
        <h3>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:</h3>
        <div id="result">--- ‡πÅ‡∏™‡∏î‡∏á JSON Response ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ---</div>
    </div>

    <div class="container">
        <h2>Log ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£:</h2>
        <div id="log"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8082/api/orders';

        function logMessage(message, isError = false) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString('th-TH');
            const color = isError ? 'red' : 'green';
            logElement.innerHTML += `<span style="color:${color};">[${timestamp}] ${message}</span><br>`;
        }
        
        // --- 1. POST (‡∏™‡∏£‡πâ‡∏≤‡∏á Order) ---

        function addItemInput() {
            const container = document.getElementById('itemsContainer');
            const newItem = document.createElement('div');
            newItem.className = 'item-input';
            newItem.innerHTML = `
                <input type="number" class="menu-id" placeholder="Menu ID">
                <input type="number" class="quantity" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                <button onclick="removeItem(this)">‡∏•‡∏ö</button>
            `;
            container.appendChild(newItem);
        }

        function removeItem(button) {
            button.parentElement.remove();
        }

        async function createOrder() {
            const tableId = document.getElementById('tableId').value;
            const itemInputs = document.querySelectorAll('#itemsContainer .item-input');
            const items = [];

            itemInputs.forEach(inputDiv => {
                const menuId = parseInt(inputDiv.querySelector('.menu-id').value);
                const quantity = parseInt(inputDiv.querySelector('.quantity').value);
                if (menuId > 0 && quantity > 0) {
                    items.push({ menuId, quantity });
                }
            });

            if (!tableId || items.length === 0) {
                logMessage('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', true);
                return;
            }

            const requestBody = { tableId: parseInt(tableId), items };
            logMessage(`‚ñ∂Ô∏è ‡∏™‡πà‡∏á POST Request: ${JSON.stringify(requestBody)}`);

            try {
                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                
                const responseJson = await response.json();
                
                if (response.ok) {
                    document.getElementById('createdOrderId').innerText = responseJson.id;
                    document.getElementById('fetchOrderId').value = responseJson.id;
                    logMessage(`‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á Order ID ${responseJson.id} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! Status: ${response.status}`);
                } else {
                    logMessage(`‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î! Status: ${response.status}. Response: ${JSON.stringify(responseJson)}`, true);
                }
            } catch (error) {
                logMessage(`‚ùå Network Error: ${error.message}. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Service 8082 ‡∏£‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà`, true);
            }
        }
        
        // --- 2. GET (‡∏î‡∏∂‡∏á Order) ---

        async function fetchOrderDetails() {
            const orderId = document.getElementById('fetchOrderId').value;
            if (!orderId) {
                logMessage('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Order ID', true);
                return;
            }

            const url = `${API_BASE_URL}/${orderId}`;
            logMessage(`‚ñ∂Ô∏è ‡∏™‡πà‡∏á GET Request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á: ${url}`);

            try {
                const response = await fetch(url, { method: 'GET' });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('result').innerText = JSON.stringify(data, null, 4);
                    logMessage(`‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Order ID ${orderId} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! Status: ${response.status}`);
                } else {
                    const responseText = await response.text();
                    document.getElementById('result').innerText = responseText;
                    logMessage(`‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î! Status: ${response.status}. Response: ${responseText}`, true);
                }
            } catch (error) {
                logMessage(`‚ùå Network Error: ${error.message}. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Service 8082 ‡∏£‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà`, true);
                document.getElementById('result').innerText = `Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>